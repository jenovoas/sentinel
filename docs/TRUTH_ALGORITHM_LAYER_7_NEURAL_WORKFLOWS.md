# ğŸ§  Truth Algorithm - Layer 7: Neural Workflow Network
## *n8n + AnÃ¡lisis Comportamental + DetecciÃ³n Inconsciente*

**Fecha**: 2025-12-17  
**InspiraciÃ³n**: Sentinel n8n workflows (patrones ataque/defensa) â†’ Aplicado a verdad/mentira  
**Status**: ğŸ¤¯ GAME CHANGER

---

## ğŸ’¡ El Concepto: Red Neuronal de Workflows

### **De Sentinel a Truth Algorithm**:

**Sentinel (lo que ya hicimos)**:
```
n8n Workflows â†’ Detectan patrones de ataque/defensa
â”œâ”€ Workflow 1: Detecta port scanning
â”œâ”€ Workflow 2: Detecta SQL injection
â”œâ”€ Workflow 3: Detecta DDoS patterns
â””â”€ Red neuronal: Combina workflows para detectar ataques complejos
```

**Truth Algorithm (aplicaciÃ³n nueva)**:
```
n8n Workflows â†’ Detectan patrones de verdad/mentira
â”œâ”€ Workflow 1: AnÃ¡lisis de microexpresiones (video)
â”œâ”€ Workflow 2: AnÃ¡lisis de voz (pitch, velocidad, pausas)
â”œâ”€ Workflow 3: Lenguaje corporal (gestos inconscientes)
â”œâ”€ Workflow 4: Patrones lingÃ¼Ã­sticos (evasiÃ³n, sobrecerteza)
â”œâ”€ Workflow 5: Contexto temporal (timing sospechoso)
â””â”€ Red neuronal: Combina workflows para detectar mentiras
```

---

## ğŸ—ï¸ Arquitectura: Layer 7 Neural Workflow Network

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 7: NEURAL WORKFLOW NETWORK ğŸ§  NUEVO                   â”‚
â”‚ - n8n workflows para anÃ¡lisis multimodal                    â”‚
â”‚ - Microexpresiones faciales (video)                         â”‚
â”‚ - AnÃ¡lisis de voz (pitch, pausas, velocidad)                â”‚
â”‚ - Lenguaje corporal (gestos inconscientes)                  â”‚
â”‚ - Patrones lingÃ¼Ã­sticos (evasiÃ³n, sobrecerteza)             â”‚
â”‚ - Red neuronal: Combina seÃ±ales para "Truth Score"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 6: TRUTH GUARDIAN                                     â”‚
â”‚ - PredicciÃ³n viralidad + campaÃ±as coordinadas               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 5: HUMAN EXPERT VALIDATION                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Workflows de DetecciÃ³n (n8n)

### **Workflow 1: Microexpresiones Faciales** ğŸ˜â†’ğŸ˜¬

**Input**: Video del speaker (TV, entrevista, conferencia)  
**Output**: Deception Score (0-100)

**QuÃ© detecta**:
- âœ… **Microexpresiones** (duran <200ms, inconscientes)
  - Desprecio (labio superior levantado)
  - Miedo (cejas levantadas, ojos abiertos)
  - Disgusto (nariz arrugada)
- âœ… **Timing**: ExpresiÃ³n antes/despuÃ©s de claim
- âœ… **Incongruencia**: Sonrisa falsa (solo boca, no ojos)

**n8n Workflow**:
```
[Trigger: Video Input]
    â†“
[OpenCV: Face Detection]
    â†“
[MediaPipe: Facial Landmarks (468 puntos)]
    â†“
[Custom Model: Microexpression Classifier]
    â†“
[Timing Analysis: Expression vs Claim]
    â†“
[Output: Deception Score + Timestamps]
```

**Ejemplo**:
```
Claim: "I did not have financial dealings with that company"
â”œâ”€ Frame 127 (0.5s antes): MicroexpresiÃ³n de miedo (80ms)
â”œâ”€ Frame 142 (durante claim): Sonrisa falsa (solo boca)
â”œâ”€ Frame 158 (0.3s despuÃ©s): Desprecio (labio superior)
â””â”€ Deception Score: 78/100 ğŸ”´
```

---

### **Workflow 2: AnÃ¡lisis de Voz** ğŸ¤

**Input**: Audio del speaker  
**Output**: Voice Stress Score (0-100)

**QuÃ© detecta**:
- âœ… **Pitch elevado** (estrÃ©s, mentira)
- âœ… **Velocidad aumentada** (nerviosismo)
- âœ… **Pausas inusuales** (fabricaciÃ³n en tiempo real)
- âœ… **Micro-temblores** (voz temblorosa)
- âœ… **Clearing throat** (seÃ±al de incomodidad)

**n8n Workflow**:
```
[Trigger: Audio Input]
    â†“
[Whisper: Transcription + Timestamps]
    â†“
[Librosa: Pitch/Tempo/Energy Analysis]
    â†“
[Custom Model: Voice Stress Detector]
    â†“
[Pause Pattern Analysis]
    â†“
[Output: Voice Stress Score + Anomalies]
```

**Ejemplo**:
```
Claim: "The election was completely fair"
â”œâ”€ Pitch: +15% vs baseline (estrÃ©s)
â”œâ”€ Pause antes de "completely": 1.2s (fabricaciÃ³n)
â”œâ”€ Velocidad: +22% vs baseline (nerviosismo)
â”œâ”€ Micro-temblor detectado: 3 instancias
â””â”€ Voice Stress Score: 72/100 ğŸ”´
```

---

### **Workflow 3: Lenguaje Corporal** ğŸ¤¸

**Input**: Video full-body del speaker  
**Output**: Body Language Score (0-100)

**QuÃ© detecta**:
- âœ… **Gestos de autoconsuelo** (tocarse cara, cuello)
- âœ… **Barreras fÃ­sicas** (cruzar brazos, alejar cuerpo)
- âœ… **Gestos incongruentes** (negar con cabeza mientras dice "sÃ­")
- âœ… **Micro-movimientos** (pies inquietos, manos temblorosas)
- âœ… **DirecciÃ³n de mirada** (evitar contacto visual)

**n8n Workflow**:
```
[Trigger: Video Input]
    â†“
[MediaPipe: Pose Detection (33 puntos)]
    â†“
[Hand Tracking: Gestos de manos]
    â†“
[Eye Gaze Tracking: DirecciÃ³n de mirada]
    â†“
[Custom Model: Body Language Classifier]
    â†“
[Incongruence Detection: Gesto vs Palabra]
    â†“
[Output: Body Language Score + Timestamps]
```

**Ejemplo**:
```
Claim: "I'm very confident about this"
â”œâ”€ Gesto: Tocarse cuello (autoconsuelo) durante "confident"
â”œâ”€ Brazos cruzados (barrera) durante claim
â”œâ”€ Mirada: Evita cÃ¡mara 73% del tiempo
â”œâ”€ Pies: Movimiento inquieto (12 veces/min)
â””â”€ Body Language Score: 81/100 ğŸ”´
```

---

### **Workflow 4: Patrones LingÃ¼Ã­sticos** ğŸ“

**Input**: TranscripciÃ³n del claim  
**Output**: Linguistic Deception Score (0-100)

**QuÃ© detecta**:
- âœ… **EvasiÃ³n** ("I don't recall", "to the best of my knowledge")
- âœ… **Sobrecerteza** ("absolutely", "100%", "never")
- âœ… **Distanciamiento** ("that woman" vs "Monica", tercera persona)
- âœ… **Falta de detalles** (claims vagos, sin especificidad)
- âœ… **Contradicciones** (con statements previos)

**n8n Workflow**:
```
[Trigger: Text Input]
    â†“
[NLP: Tokenization + POS Tagging]
    â†“
[Pattern Matching: Evasion phrases]
    â†“
[Certainty Analysis: Hedge words vs absolutes]
    â†“
[Pronoun Analysis: Distancing patterns]
    â†“
[Historical Comparison: Contradicciones]
    â†“
[Output: Linguistic Deception Score]
```

**Ejemplo**:
```
Claim: "I don't recall having any financial dealings with that individual"
â”œâ”€ EvasiÃ³n: "I don't recall" (hedge)
â”œâ”€ Distanciamiento: "that individual" (no nombre)
â”œâ”€ Falta de detalles: No especifica quÃ©, cuÃ¡ndo, dÃ³nde
â”œâ”€ ContradicciÃ³n: Dijo "never met" hace 2 semanas
â””â”€ Linguistic Deception Score: 68/100 ğŸ”´
```

---

### **Workflow 5: Contexto Temporal** â°

**Input**: Claim + timestamp + contexto  
**Output**: Timing Suspicion Score (0-100)

**QuÃ© detecta**:
- âœ… **Timing sospechoso** (claim justo antes de evento)
- âœ… **Cambio de narrativa** (claim contradice previos)
- âœ… **PresiÃ³n externa** (claim despuÃ©s de acusaciÃ³n)
- âœ… **PatrÃ³n de retractaciÃ³n** (histÃ³rico de cambios)

**n8n Workflow**:
```
[Trigger: Claim + Metadata]
    â†“
[Timeline Analysis: Claim vs Events]
    â†“
[Historical Search: Previous claims]
    â†“
[Contradiction Detection]
    â†“
[Pressure Analysis: External events]
    â†“
[Output: Timing Suspicion Score]
```

**Ejemplo**:
```
Claim: "I never met with Russian officials" (March 2017)
â”œâ”€ Timeline: 2 dÃ­as despuÃ©s de acusaciÃ³n en prensa
â”œâ”€ HistÃ³rico: Dijo "met once" en Feb 2017
â”œâ”€ PresiÃ³n: InvestigaciÃ³n FBI anunciada ayer
â”œâ”€ PatrÃ³n: 3 retractaciones en 6 meses
â””â”€ Timing Suspicion Score: 89/100 ğŸ”´
```

---

## ğŸ§  Red Neuronal: Combina Workflows

### **Arquitectura**:

```
[Workflow 1: Microexpresiones] â†’ Score: 78/100
[Workflow 2: Voz]              â†’ Score: 72/100
[Workflow 3: Lenguaje Corporal]â†’ Score: 81/100
[Workflow 4: LingÃ¼Ã­stico]      â†’ Score: 68/100
[Workflow 5: Temporal]         â†’ Score: 89/100
                â†“
        [NEURAL NETWORK]
        Weighted Combination
                â†“
        [TRUTH SCORE: 76/100]
        Confidence: HIGH (5 seÃ±ales)
        Verdict: LIKELY DECEPTIVE ğŸ”´
```

### **Pesos de la Red**:

```rust
pub struct NeuralWeights {
    microexpressions: f32,  // 0.25 (muy confiable)
    voice: f32,             // 0.20 (confiable)
    body_language: f32,     // 0.20 (confiable)
    linguistic: f32,        // 0.15 (moderado)
    temporal: f32,          // 0.20 (confiable)
}

impl Default for NeuralWeights {
    fn default() -> Self {
        NeuralWeights {
            microexpressions: 0.25,
            voice: 0.20,
            body_language: 0.20,
            linguistic: 0.15,
            temporal: 0.20,
        }
    }
}

pub fn calculate_truth_score(
    workflows: &WorkflowScores,
    weights: &NeuralWeights
) -> TruthScore {
    let weighted_sum = 
        workflows.microexpressions * weights.microexpressions +
        workflows.voice * weights.voice +
        workflows.body_language * weights.body_language +
        workflows.linguistic * weights.linguistic +
        workflows.temporal * weights.temporal;
    
    let confidence = calculate_confidence(&workflows);
    
    TruthScore {
        score: weighted_sum,
        confidence,
        verdict: determine_verdict(weighted_sum),
        signals: workflows.active_signals(),
    }
}
```

---

## ğŸ¯ Casos de Uso

### **1. AnÃ¡lisis de Entrevistas PolÃ­ticas** ğŸ™ï¸

```
Input: Video de entrevista polÃ­tica
    â†“
[Layer 7: Neural Workflows]
â”œâ”€ Microexpresiones: 82/100 (deceptivo)
â”œâ”€ Voz: 71/100 (estrÃ©s moderado)
â”œâ”€ Lenguaje corporal: 78/100 (incongruente)
â”œâ”€ LingÃ¼Ã­stico: 65/100 (evasivo)
â””â”€ Temporal: 88/100 (timing sospechoso)
    â†“
Truth Score: 77/100 ğŸ”´ LIKELY DECEPTIVE
    â†“
[Layer 6: Truth Guardian]
â”œâ”€ Viral Risk: 91/100 (polÃ­tico + controversial)
â”œâ”€ Campaign Score: 45/100 (no coordinado)
â””â”€ Priority: 2 (HIGH)
    â†“
[Layer 5: Human Expert Review]
â””â”€ Expert: "Confirmo seÃ±ales de evasiÃ³n"
```

---

### **2. VerificaciÃ³n de Testimonios Judiciales** âš–ï¸

```
Input: Video de testimonio bajo juramento
    â†“
[Layer 7: Neural Workflows]
â”œâ”€ Microexpresiones: 23/100 (congruente)
â”œâ”€ Voz: 18/100 (calmado)
â”œâ”€ Lenguaje corporal: 15/100 (abierto)
â”œâ”€ LingÃ¼Ã­stico: 28/100 (especÃ­fico, detallado)
â””â”€ Temporal: 12/100 (consistente histÃ³rico)
    â†“
Truth Score: 19/100 ğŸŸ¢ LIKELY TRUTHFUL
    â†“
[Layer 6: Truth Guardian]
â””â”€ Priority: 5 (NORMAL - no red flags)
```

---

### **3. DetecciÃ³n de Deepfakes** ğŸ¤–

```
Input: Video sospechoso de ser deepfake
    â†“
[Layer 7: Neural Workflows]
â”œâ”€ Microexpresiones: 95/100 (NO DETECTADAS - red flag)
â”œâ”€ Voz: 88/100 (sÃ­ntesis artificial detectada)
â”œâ”€ Lenguaje corporal: 92/100 (movimientos no naturales)
â”œâ”€ LingÃ¼Ã­stico: 15/100 (texto normal)
â””â”€ Temporal: 78/100 (timing perfecto - sospechoso)
    â†“
Truth Score: 74/100 ğŸ”´ LIKELY SYNTHETIC
Deepfake Probability: 89%
    â†“
[Alert: DEEPFAKE DETECTED]
```

---

## ğŸ”§ ImplementaciÃ³n n8n

### **n8n Workflow Template**:

```json
{
  "name": "Truth Detection - Microexpressions",
  "nodes": [
    {
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "parameters": {
        "path": "truth/microexpressions"
      }
    },
    {
      "name": "OpenCV Face Detection",
      "type": "n8n-nodes-base.executeCommand",
      "parameters": {
        "command": "python /opt/truth/detect_faces.py"
      }
    },
    {
      "name": "MediaPipe Landmarks",
      "type": "n8n-nodes-base.httpRequest",
      "parameters": {
        "url": "http://mediapipe-service:8080/landmarks"
      }
    },
    {
      "name": "Microexpression Classifier",
      "type": "n8n-nodes-base.httpRequest",
      "parameters": {
        "url": "http://ml-service:8080/classify"
      }
    },
    {
      "name": "Calculate Deception Score",
      "type": "n8n-nodes-base.function",
      "parameters": {
        "functionCode": "// Calculate weighted score..."
      }
    },
    {
      "name": "Store Results",
      "type": "n8n-nodes-base.postgres",
      "parameters": {
        "operation": "insert",
        "table": "microexpression_results"
      }
    }
  ]
}
```

---

## ğŸ“Š MÃ©tricas Layer 7

### **Accuracy Targets**:
- **Microexpresiones**: >80% accuracy
- **Voz**: >75% accuracy
- **Lenguaje corporal**: >70% accuracy
- **LingÃ¼Ã­stico**: >85% accuracy
- **Temporal**: >90% accuracy
- **Combined (Neural Net)**: >82% accuracy

### **Performance**:
- **Latency**: <5s por workflow
- **Total (5 workflows paralelos)**: <5s
- **Throughput**: 100 anÃ¡lisis/hora

---

## ğŸš€ Roadmap de ImplementaciÃ³n

### **Fase 1: POC (Semanas 1-4)**:
- âœ… Workflow 4: LingÃ¼Ã­stico (mÃ¡s fÃ¡cil, solo texto)
- âœ… Workflow 5: Temporal (solo metadata)
- âœ… Red neuronal simple (2 workflows)

### **Fase 2: MVP (Semanas 5-8)**:
- âœ… Workflow 2: Voz (audio analysis)
- âœ… Integrar 3 workflows en red neuronal
- âœ… Testing con dataset pÃºblico

### **Fase 3: Completo (Semanas 9-12)**:
- âœ… Workflow 1: Microexpresiones (video)
- âœ… Workflow 3: Lenguaje corporal (video)
- âœ… Red neuronal completa (5 workflows)
- âœ… Deepfake detection

---

## ğŸ’¡ Ventaja Competitiva

### **Por quÃ© nadie lo tiene**:
1. âŒ Requiere expertise en ML + CV + NLP + n8n
2. âŒ Requiere datasets masivos (1M+ samples)
3. âŒ Requiere infraestructura compleja (video processing)
4. âŒ Requiere validaciÃ³n Ã©tica/legal

### **Por quÃ© tÃº sÃ­ puedes**:
1. âœ… Ya tienes experiencia con n8n workflows (Sentinel)
2. âœ… Arquitectura modular (workflows independientes)
3. âœ… Puedes empezar simple (solo lingÃ¼Ã­stico + temporal)
4. âœ… Escalas gradualmente (agregar video despuÃ©s)

---

## âœ… Resumen Ejecutivo

**Layer 7 (Neural Workflow Network)** es tu **diferenciador absoluto**:

- ğŸ§  **Red neuronal de workflows** (como Sentinel, pero para verdad/mentira)
- ğŸ˜ **AnÃ¡lisis multimodal** (video + audio + texto + contexto)
- ğŸ¯ **DetecciÃ³n inconsciente** (microexpresiones, gestos, voz)
- ğŸ¤– **Deepfake detection** (bonus)
- ğŸ”´ **Nadie lo tiene** (competencia solo analiza texto)

**Â¿Esto es lo que querÃ­as?** ğŸš€
